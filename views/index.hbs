<link rel='stylesheet' href='/css/index.css' />
<script src="//momentjs.com/downloads/moment-with-locales.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
<script src="/js/converter.js"></script>
<script src="//momentjs.com/downloads/moment-with-locales.js"></script>

<title>Inicio</title>
<div class="index">
    <div class="notifications-panel">
        <div class="notifications-button">
            <span>&#9776;</span>
        </div>
        <div class="menu">
            <h1>Notificaciones</h1>
            <div id="notifications" class="notifications">
                
            </div>
        </div>
    </div>
    <div class="publications-menu">
        <div class="upload-publication">      
            <img src="{{avatar}}" alt="">
            <input id="button" type="text" placeholder="¿Qué estás pensando?">
            <div id="modal" class="modal">
                <div class="modal-content">
                    <div class="title">
                        <span class="close">&times;</span>
                        <p>Crear publicación</p>
                    </div>
                    <form class="message" action="/publications/uploadpublication" method="POST" id="upload-form">
                        <textarea name="text" type="text" placeholder="¿Qué estás pensando?"></textarea>
                    </form>
                    <div class="button">
                        <button type="submit" form="upload-form">Publicar</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="publications" class="publications">
            
        </div>
    </div>
    <div class="friends">
        <div class="friends-button">
            <span>&#9776;</span>
        </div>
        <div class="menu">
            <h1>Amigos</h1>
            
        </div>
    </div>
</div>

<script>
    var button = document.getElementById("button");
    var modal = document.getElementById("modal");
    var span = document.getElementsByClassName("close")[0];
    var notifications = document.getElementById('notifications')
    var publications = document.getElementById('publications')

    button.onclick = function () {
        modal.style.display = "block";
    }
    span.onclick = function () {
        modal.style.display = "none";
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    const buttonToggleNotifications = document.querySelector('.notifications-button');
    buttonToggleNotifications.addEventListener('click', function () {
        document.querySelector('.notifications-panel').classList.toggle('active');
    });

    const buttonToggleFriends = document.querySelector('.friends-button');
    buttonToggleFriends.addEventListener('click', function () {
        document.querySelector('.friends').classList.toggle('active');
    });

    $.get("http://localhost:3000/user/getnotifications", data => {
        if (data.status) {
            $.each(data.userNotifications, function () {
                notifications.innerHTML +=
                    '<div class="notification">'+
                       '<div class="notification-info">'+
                           '<div class="user-avatar">'+         
                               '<img src="' + this.from.avatar + '" alt="">'+
                           '</div>'+
                           '<div class="user-info">'+
                               '<p> El usuario ' + this.from.name + ' te ha enviado una solicitud de amistad </p> Hace ' + convertDate(this.createdAt) +
                           '</div>'+
                       '</div>'+
                       '<form class="notification-action" action="/user/acceptfriend/' + this._id + '/'+ this.from._id+'" method="POST">'+
                           '<button name="request" value="add" class="add">Añadir amigo</button>'+
                           '<button name="request" value="refuse" class="refuse">Rechazar</button>'+
                       '</form>'+
                   '</div>'
            })
        } else {
            notifications.innerHTML = data.message
        }
    });

    $.get("http://localhost:3000/publications/getallpublications", data => {
        if (data.status) {
            $.each(data.publications, function () {
                publications.innerHTML +=       
                   '<div class="publication">'+
                        '<div class="publication-info">'+
                            '<div class="user-avatar">'+
                                '<img src="' + this.user[0].avatar + '" alt="">'+
                            '</div>'+
                            '<div class="user-info">' + this.user[0].name + ' ' + this.user[0].surname + '<br>hace ' + convertDate(this.createdAt) +
                            '</div>'+
                        '</div>'+
                        '<div class="publication-description">' + this.description +
                        '</div>'+
                    '</div>'
            })
        } else {
            publications.innerHTML = data.message
        }
    });

    
</script>