<link rel='stylesheet' href='/css/index.css' />
<script src="//momentjs.com/downloads/moment-with-locales.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
<script src="/try/examples/js/handlebars_helpers_if_eq.js"></script>
<title>Inicio</title>
<div class="index">
    <div class="notifications-panel">
        <div class="notifications-button">
            <span>&#9776;</span>
        </div>
        <div class="menu">
            <h1>Notificaciones</h1>
            <div class="notifications">
                {{#each userLogged}}
                    {{#each notifications}}
                        <div class="notification">
                            <div class="notification-info">
                                <div class="user-avatar">         
                                    <img src="{{../avatar}}" alt="">
                                </div>
                                <div class="user-info">
                                    <p>El usuario
                                    {{#each this}}
                                        <!-- {{#ifEquals notificationRequest 'add'}} esto llama al helper que si anda
                                            sosputo
                                        {{/ifEquals}}-->
                                        {{#each from}}
                                            {{name}}
                                        {{/each}}
                                    {{/each}}
                                    te ha enviado una solicitud de amistad
                                    </p>
                                    {{#this}}
                                        Hace {{converter createdAt}}
                                    {{/this}}
                                </div>
                            </div>
                            <form class="notification-action" action="/user/addfriend/{{_id}}" method="POST">
                                <button name="request" value="add" class="add">Añadir amigo</button>
                                <button name="request" value="refuse" class="refuse">Rechazar</button>
                            </form>
                        </div>
                    {{/each}}
                {{/each}}
            </div>
        </div>
    </div>

    <div class="publications-menu">
        <div class="upload-publication">
            {{#each userLogged}}
            
                    <img src="{{#avatar}} {{/avatar}}" alt="imagendeperfil">
           
            {{/each}}
            
            <input id="button" type="text" placeholder="¿Qué estás pensando?">
            <div id="modal" class="modal">
                <div class="modal-content">
                    <div class="title">
                        <span class="close">&times;</span>
                        <p>Crear publicación</p>
                    </div>
                    <form class="message" action="/publications/uploadpublication" method="POST" id="upload-form">
                        <textarea name="text" type="text" placeholder="¿Qué estás pensando?"></textarea>
                    </form>
                    <div class="button">
                        <button type="submit" form="upload-form">Publicar</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="publications">
            {{#if publications}}
            {{#each publications}}
            <div class="publication">
                <div class="publication-info">
                    <div class="user-avatar">
                        {{#each user}}
                        <img src="{{avatar}}" alt="">
                        {{/each}}
                    </div>
                    <div class="user-info">
                        {{#each user}}
                        {{name}} {{surname}} <br>hace {{converter ../this.createdAt}}
                        {{/each}}
                    </div>
                </div>
                <div class="publication-description">
                    {{description}}
                </div>
            </div>
            {{/each}}
            {{else}}
            <h1>No hay publicaciones que mostrar, ¡Sé el primero!</h1>
            {{/if}}
        </div>
    </div>
    <div class="friends">
        <div class="friends-button">
            <span>&#9776;</span>
        </div>
        <div class="menu">
            <h1>Amigos</h1>
            
        </div>
    </div>
</div>

<script>
    var button = document.getElementById("button");
    var modal = document.getElementById("modal");
    var span = document.getElementsByClassName("close")[0];
    button.onclick = function () {
        modal.style.display = "block";
    }
    span.onclick = function () {
        modal.style.display = "none";
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    const buttonToggleNotifications = document.querySelector('.notifications-button');
    buttonToggleNotifications.addEventListener('click', function () {
        document.querySelector('.notifications-panel').classList.toggle('active');
    });

    const buttonToggleFriends = document.querySelector('.friends-button');
    buttonToggleFriends.addEventListener('click', function () {
        document.querySelector('.friends').classList.toggle('active');
    });
</script>